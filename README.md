# FastAPI Book Management API

## Overview

This project is a RESTful API built with FastAPI for managing a book collection. It provides comprehensive CRUD (Create, Read, Update, Delete) operations for books with proper error handling, input validation, and documentation.

**Key enhancements in this version include:**

* **Implemented a new endpoint:**  A dedicated endpoint `GET /api/v1/books/{book_id}` has been added to retrieve a specific book by its ID, returning a 404 response if the book is not found.
* **Containerized with Docker and Nginx:** The application is packaged and served using Docker, with Nginx configured as a reverse proxy to handle API requests efficiently.
* **Automated CI/CD Pipeline:** A Continuous Integration and Continuous Deployment (CI/CD) pipeline has been set up using GitHub Actions. This pipeline automatically runs tests on pull requests and deploys new changes to a Render-hosted environment upon merging to the `main` branch.

The API maintains the original features, including CRUD operations, input validation, genre classification, test coverage, API documentation, and CORS enabled middleware, while incorporating these key improvements for enhanced functionality and deployment.

## Features

* 📚 Book management (CRUD operations: Create, Read, Update, Delete)
* ✅ Input validation using Pydantic models for request bodies and responses.
* 🔍 Enum-based genre classification for books.
* 🧪 Comprehensive test coverage with pytest, ensuring API reliability.
* 📝 API documentation automatically generated by FastAPI, available in Swagger UI and ReDoc.
* ⚙️ CORS (Cross-Origin Resource Sharing) middleware enabled to allow requests from any origin.
* 🚀 **Deployed and Served via Nginx:** The application is containerized with Docker and served using Nginx as a reverse proxy for enhanced performance and security.
* 🔄 **Automated CI/CD Pipeline:** Implemented using GitHub Actions for continuous integration (testing) and continuous deployment to Render.

## Project Structure

```text
fastapi-book-project/
├── api/
│   ├── db/
│   │   ├── __init__.py
│   │   ├── database.py     # Shared in-memory database instance
│   │   └── schemas.py      # Data models and in-memory database schemas
│   ├── routes/
│   │   ├── __init__.py
│   │   ├── books.py        # Book route handlers (original endpoints)
│   │   └── v1_books.py     # Versioned book route handlers (new /api/v1 endpoint)
│   └── router.py           # API router configuration, combining all routes
├── core/
│   ├── __init__.py
│   └── config.py           # Application settings (API prefix, etc.)
├── tests/
│   ├── __init__.py
│   └── test_books.py       # API endpoint tests (pytest)
├── .github/
│   └── workflows/
│       ├── ci.yml          # CI pipeline workflow (runs tests on PRs)
│       └── deploy.yml      # CD pipeline workflow (deploys to Render on main branch push)
├── Dockerfile              # Dockerfile for containerizing the application with Nginx
├── nginx.conf              # Nginx configuration file for reverse proxy
├── supervisord.conf        # Supervisor configuration to manage Uvicorn and Nginx processes
├── main.py                 # Application entry point (FastAPI app instance)
├── requirements.txt        # Project dependencies (Python packages)
└── README.md               # Project documentation (this file)
```

**Note:**  `database.py` and `v1_books.py` have been added to reflect the changes made in this stage. The `.github/workflows`, `Dockerfile`, `nginx.conf`, and `supervisord.conf` directories and files are also added to document the CI/CD and Docker setup.

## Technologies Used

* Python 3.9 (as specified in `.github/workflows/ci.yml` and `Dockerfile`)
* FastAPI - Modern, fast (high-performance), web framework for building APIs with Python 3.7+
* Pydantic - Data validation and settings management using Python type annotations.
* pytest - Testing framework for Python.
* Uvicorn - ASGI server for running FastAPI applications.
* Docker - Platform for developing, shipping, and running applications in containers.
* Nginx - High-performance web server and reverse proxy.
* GitHub Actions -  CI/CD platform to automate build, test, and deployment pipelines.
* Render - Cloud platform for hosting web applications and services.

## Installation

1. **Clone the repository:**

    ```bash
    git clone https://github.com/darexxel/hngx-stage2-fastapi-book-project
    cd fastapi-book-project
    ```

2. **Create a virtual environment:**

    ```bash
    python -m venv venv
    source venv/bin/activate  # On Linux/macOS
    venv\Scripts\activate     # On Windows
    ```

3. **Install dependencies:**

    ```bash
    pip install --upgrade pip
    pip install -r requirements.txt
    pip install pytest  # Install pytest for running tests locally
    ```

## Running the Application Locally

1. **Start the FastAPI application (Uvicorn):**

    ```bash
    uvicorn main:app --reload
    ```

    This command starts the FastAPI application using Uvicorn server with hot-reloading enabled for development.

2. **Access the API documentation:**

    Once the server is running, you can access the automatically generated API documentation:

    * Swagger UI:  [http://localhost:8000/docs](http://localhost:8000/docs)
    * ReDoc:     [http://localhost:8000/redoc](http://localhost:8000/redoc)

## API Endpoints

### Books (Version 1 - `/api/v1/books`)

* `GET /api/v1/books/{book_id}` - **Retrieve a specific book by ID.**
  * Parameters: `book_id` (integer) - ID of the book to retrieve.
  * Responses:
    * `200 OK`: Successful response with book details in JSON format.
    * `404 Not Found`: If a book with the given ID does not exist.

### Books (Original Endpoints - `/books`)

* `GET /books/` - **Get all books.** Returns a JSON response with all books in the collection.
* `POST /books/` - **Create a new book.**
  * Request Body: JSON payload representing the book details (see Book Schema).
  * Responses:
    * `201 Created`: Successful creation of the book.
* `PUT /books/{book_id}` - **Update an existing book.**
  * Parameters: `book_id` (integer) - ID of the book to update.
  * Request Body: JSON payload with updated book details (see Book Schema).
  * Responses:
    * `200 OK`: Successful update of the book.
* `DELETE /books/{book_id}` - **Delete a book.**
  * Parameters: `book_id` (integer) - ID of the book to delete.
  * Responses:
    * `204 No Content`: Successful deletion.

### Health Check

* `GET /healthcheck` - **Check API status.** Returns a JSON response indicating if the API is active.

## Book Schema

```json
{
  "id": integer,
  "title": string,
  "author": string,
  "publication_year": integer,
  "genre": string (enum: "Science Fiction", "Fantasy", "Horror", "Mystery", "Romance", "Thriller")
}
```

Available genres:

* Science Fiction
* Fantasy
* Horror
* Mystery
* Romance
* Thriller

## Running Tests

To ensure the API functions correctly, run the pytest test suite:

```bash
pytest
```

This command executes all tests located in the `tests/` directory and reports the test results.

## Deployment

The application is deployed automatically using a Continuous Deployment (CD) pipeline with GitHub Actions to [Render](https://render.com).

### Prerequisites for Deployment

* **Render Account:** You need a Render account to deploy the application. Sign up at [https://render.com/](https://render.com/).
* **Render API Key:**  Generate an API Key from your Render Account Settings (Account Settings -> API Keys) and securely store it.
* **Render Service ID:** Create a Web Service on Render, connect your forked GitHub repository, and note down the Service ID from your service's settings or URL.
* **GitHub Repository Secrets:** In your GitHub repository settings (Settings -> Secrets and variables -> Actions), add the following repository secrets:
  * `RENDER_API_KEY`:  Set the value to your Render API Key.
  * `RENDER_SERVICE_ID`: Set the value to your Render Service ID.

### Deployment Process

1. **GitHub Actions Workflow:**  The deployment process is automated using the `.github/workflows/deploy.yml` GitHub Actions workflow.
2. **Trigger:**  The CD pipeline is triggered automatically whenever changes are pushed to the `main` branch of the repository.
3. **Actions:**
    * The workflow checks out the code.
    * It uses the `render-oss/github-action` to signal Render to deploy the application.
    * Render pulls the latest code from the `main` branch, builds the Docker image using the provided `Dockerfile`, and deploys the updated application.

### Accessing the Deployed Application

Once the deployment pipeline completes successfully, the application will be publicly accessible at the Render-provided URL. You can find the URL in your Render Web Service dashboard.

**Base URL of Deployed Application:**  [https://hngx-stage2-fastapi-book-project-w51x.onrender.com](https://hngx-stage2-fastapi-book-project-w51x.onrender.com)

**Verify Deployment:** After deployment, you can verify that the application is running by accessing the health check endpoint:

[https://hngx-stage2-fastapi-book-project-w51x.onrender.com/healthcheck](https://hngx-stage2-fastapi-book-project-w51x.onrender.com/healthcheck)

You should receive a JSON response: `{"status": "active"}`

## Nginx Configuration

The application is served behind Nginx, configured as a reverse proxy within the Docker container. The Nginx configuration file (`nginx.conf`) is located in the project root and is copied into the Docker image during the build process.

The configuration is set up to:

* Listen on port 80 for HTTP traffic.
* Proxy requests to the FastAPI application running on Uvicorn at `http://127.0.0.1:8000`.
* Set necessary headers for proxying (`Host`, `X-Real-IP`, `X-Forwarded-For`, `X-Forwarded-Proto`).

## CI/CD Pipeline Details

### Continuous Integration (CI)

* **Workflow File:** `.github/workflows/ci.yml`
* **Trigger:**  Runs automatically on every pull request to the `main` branch.
* **Job:** `test`
* **Actions:**
  * Checks out the code.
  * Sets up Python environment.
  * Installs dependencies.
  * Runs pytest test suite.
  * Fails the CI workflow if any tests fail, ensuring that only code that passes all tests can be merged.

### Continuous Deployment (CD)

* **Workflow File:** `.github/workflows/deploy.yml`
* **Trigger:** Runs automatically when code is pushed to the `main` branch (typically after merging a pull request).
* **Job:** `deploy`
* **Actions:**
  * Checks out the code.
  * Uses the `render-oss/github-action` to trigger a deployment on Render.
  * Render then builds and deploys the Docker containerized application.

## Error Handling

The API includes comprehensive error handling, including:

* **404 Not Found:** Returned when a book with a given ID does not exist (e.g., `GET /api/v1/books/{book_id}` with an invalid ID).
* **422 Unprocessable Entity:** Returned for invalid request data (e.g., invalid book schema in `POST /books/` or `PUT /books/{book_id}`).
* **Internal Server Errors:**  Handled gracefully, with appropriate logging.

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Support

For support, please open an issue in the GitHub repository.

---
